# 자바 메모리 구조
![[Pasted image 20241114144434.png]]
- 자바의 메모리 구조
	- 메서드 영역
		- 클래스(붕어빵 틀) 정보를 보관한다.
	- 스택 영역
		- 실제 프로그램이 실행되는 영역
		- 메서드를 실행할 때 마다 하나씩 쌓인다.
	- 힙 영역
		- 객체(인스턴스)가 생성되는 영역
		- 클래스(붕어빵 틀)로부터 생성된 객체(붕어빵)이 존재하는 공간이다.
		- 배열도 이 영역에 생성된다.


![[Pasted image 20241114144632.png]]


- 자바의 메모리 구조
	- 메서드 영역(Method Area)
		- 프로그램을 실행하는데 필요한 **공통 데이터를 관리한다.**
		- 이 영역은 프로그램의 **모든 영역에 공유한다.**
			- 클래스 정보: 클래스의 실행코드(바이트 코드), **필드, 메서드와 생성자 코드**등 모든 실행 코드가 존재한다.
			- static 영역: `static`변수들을 보관한다.
			- 런타임 상수 풀: 프로그램을 실행하는데 필요한 공통 `리터럴 상수`를 보관한다.
	- 스택 영역(Stack Area)
		- 자바 실행 시, 하나의 실행 스택이 생성된다.
		- 각 스택 프레임은 지역 변수, 중간 연산 결과, 메서드 호출 정보 등을 포함한다.
		- 스택 프레임: 스택 영역에 쌓이는 네모 박스가 하나의 스택 프레임이다.
		  **메서드를 호출할 때 마다 하나의 스택 프레임이 쌓이고, 메서드가 종료되면 해당 스택 프레임이 제거된다.**
	- 힙 영역(Heap Area)
		- **객체(인스턴스)와 배열이 생성되는 영역.**
		- **가비지 컬렉션(GC)이 이뤄지는 주요 영역**이며, 더 이상 참조되지 않는 객체는 GC에 의해 제거된다.

![[Pasted image 20241114145311.png]]
- 자바에서 Data 클래스로 2개의 인스턴스를 생성했을 때, 힙 메모리에 2개의 인스턴스 생성.
- 같은 클래스로부터 생성된 객체라도, 인스턴스 내부의 변수 값은 서로 다를 수 있지만,
  **메서드는 공통된 코드를 공유한다.**
- 따라서 객체가 생성될 때, 인스턴스 변수에는 메모리가 할당되지만,
  **메서드에 대한 새로운 메모리 할당은 없다.**
- **메서드는 메서드 영역에서 공통으로 관리되고 실행된다.**
- 인스턴스의 메서드를 호출하면 **실제로는 메서드 영역에 있는 코드를 불러서 수행한다.**




# 스택 영역과 힙 영역
- 자바는 스택 영역을 사용해서 메서드호출과 지역 변수(매개변수 포함)를 관리한다.
- 스택 프레임이 종료되면 지역 변수도 함께 제거된다.
- 스택 프레임이 모두 제거되면 프로그램도 종료된다.
- 스택영역에서 힙 영역을 참조하는 것이 없다면, 힙 영역에 있는 인스턴스는 GC의 대상이 되어 제거 된다.
- **힙 영역의 인스턴스는 오직 데이터(필드 값)만 보유한다.**
- - 스택 프레임이 **메서드 영역의 코드를 참조**하며, 이 스택 프레임을 통해 힙 영역의 인스턴스에 접근합니다.


### 변수가 저장되는 영역
- **클래스 변수 (static 변수)**: 클래스 변수는 메서드 영역에 저장됩니다. 이 변수는 모든 인스턴스가 공통으로 접근할 수 있습니다.
- **인스턴스 변수 (필드)**: `name`과 `count`와 같은 인스턴스 변수는 각 객체 인스턴스에 고유하게 존재하므로 **힙 영역의 인스턴스 내부에 저장됩니다**. 즉, 객체마다 고유한 `name`과 `count` 값을 가질 수 있습니다.
- **지역 변수**: 지역 변수와 메서드의 매개변수는 스택 영역에 저장됩니다.

>[!Note] 변수가 저장되는 영역
>- 클래스변수(static 변수): 메서드 영역의 static 영역
>- 지역변수(매개변수 포함): 스택 영역
>- 인스턴스 변수: 힙 영역




### 실행 순서와 메서드 호출
![[Pasted image 20241114162001.png]]

1. **클래스 로더에 의한 로드 과정**
    
    - `Data` 클래스가 처음 사용될 때, **클래스 로더**가 이 클래스를 로드하고 **메서드 영역에 클래스 정보**를 저장합니다. 이때 `add()` 메서드의 바이트코드(실행 코드)도 메서드 영역에 저장됩니다.
2. **인스턴스 생성**
    
    - `Data data = new Data();`가 실행되면, 메서드 영역에 있는 `Data` 클래스의 "설계도"에 따라 **힙 영역에 인스턴스가 생성**됩니다. 이 인스턴스는 `count` 필드를 고유하게 갖고 있습니다.
3. **메서드 호출에 따른 스택 프레임 생성**
    
    - `data.add();`를 호출하면 **스택 영역에 `add()` 메서드를 위한 스택 프레임**이 생성됩니다.
4. **스택 프레임 내 참조 저장**
    
    - 스택 프레임에는 `data` 참조가 저장되며, 이를 통해 힙 영역의 `data` 인스턴스를 참조할 수 있게 됩니다.
5. **메서드 영역에서 `add()` 메서드 코드 찾기**
    
    - 스택 프레임이 "어떻게 수많은 클래스 중에 `Data` 클래스를 찾는가?"라는 질문에 대한 답은 자바의 **정적 타입 시스템** 덕분입니다.
        - `data` 변수가 `Data` 타입으로 선언되어 있기 때문에, **컴파일 시점에 `Data` 클래스의 `add()` 메서드를 호출하도록 이미 결정**됩니다. 즉, 어떤 메서드를 호출할지는 **컴파일러가 미리 알고** 있는 것입니다.
        - 그래서 런타임에서는 타입 추론이 필요하지 않고, `data` 변수의 참조를 사용하여 **메서드 영역의 `Data` 클래스에서 `add()` 메서드의 코드를 참조**하게 됩니다.
6. **코드 실행**
    
    - `add()` 메서드의 코드가 스택 프레임에서 실행됩니다. 이때 `count++` 코드가 실행되는데, `count`는 인스턴스 변수이므로, **스택 프레임이 가지고 있는 `data` 참조를 통해 힙 영역의 `data` 인스턴스에 접근**하여 `count` 값을 증가시킵니다.
7. **결과**
    
    - `data` 인스턴스의 `count` 값이 1 증가하게 됩니다. 이로써 메서드 호출이 완료되면, 스택 프레임은 제거되고 메모리에서 해제됩니다.
    
>[!Question] 6.코드 실행
>"6. 코드 실행" 부분에 대해서 질문이 있어. add() 메서드의 코드가 스택 프레임에서 실행된다고 했는데, add() 메서드에 대한 정보는 메서드 영역이 담당하고 있어. add메서드 부분에 count++을 하라는 것도 메서드 영역을 확인해야 알 수 있는 거 아니야? 그런데 왜 메서드 영역에서 실행하지 않고, 스택 영역에서 실행한다고 할 수 있지 ?

좋은 질문입니다! **메서드의 코드 자체는 메서드 영역에 저장되지만, 메서드 실행 과정은 스택 영역에서 이루어진다**는 점을 이해하면 더 명확해집니다.

### 메서드 영역 vs 스택 영역의 역할

- **메서드 영역**: 메서드 영역은 **코드 자체**와 **클래스 정보를 저장하는 공간**입니다.
	- `add()` 메서드의 바이트코드(실행 명령어)가 메서드 영역에 저장되어 있습니다. 즉, _“어떤 명령어를 수행할지”에 대한 정의_는 메서드 영역에 있습니다.
- **스택 영역**: 스택 영역은 _메서드가 실행될 때 사용하는 실행 컨텍스트_입니다.
	- 메서드가 호출되면 **스택 프레임이 생성**되고, 여기서 **실제로 메서드의 명령어가 실행**됩니다.
	- 인스턴스의 값을 변경해야 할 때는, 스택 영역에 저장된 참조변수를 통해 인스턴스의 값을 변경한다.




# static 변수





# static 메서드